<template>

    <!-- PROJECT DETAILS CARD -->
    <lightning-card title="Project Details">
        <div class="slds-grid slds-wrap slds-p-around_medium">

            <!-- Left Column -->
            <div class="slds-col slds-size_1-of-2 slds-p-horizontal_small">
                <lightning-input label="Project Name" value={project.Name}  disabled={projectDisabled}></lightning-input>
                <lightning-input label="Project Location" value={project.Location__c}  disabled={projectDisabled}></lightning-input>
                <lightning-input label="Rera Number" value={project.RERA_Number__c}  disabled={projectDisabled}></lightning-input>
            </div>

            <!-- Right Column -->
            <div class="slds-col slds-size_1-of-2 slds-p-horizontal_small">
                <lightning-input type="number" label="No of Towers" value={project.towers}  disabled={projectDisabled}></lightning-input>
                <lightning-input type="number" label="No of Units" value={project.units}  disabled={projectDisabled}></lightning-input>
            </div>

        </div>
    </lightning-card>

    <!-- ADD POLICY BUTTON -->
    <div class="slds-m-top_medium">
        <lightning-button
            variant="brand"
            label="Add Payment Policy"
            onclick={handleAddPolicy}>
        </lightning-button>
    </div>

    <!-- POLICIES LOOP -->
    <template for:each={policies} for:item="policy" for:index="index">

        <div key={policy.id} class="slds-box slds-m-top_medium">

            <!-- POLICY ROW -->
            <div class="slds-grid slds-wrap slds-gutters slds-align_absolute-center">

                <!-- S.NO -->
                <div class="slds-col slds-size_1-of-12 slds-text-align_center">
                    <label class="slds-form-element__label">S.No</label>
                    <div class="slds-form-element__control">{policy.serial}</div>
                </div>

                <!-- POLICY NAME -->
                <div class="slds-col slds-size_3-of-12">
                    <lightning-input
                        label="Policy Name"
                        value={policy.name}
                        data-index={index}
                        onchange={handleNameChange}
                        disabled={policy.isDisabled}>
                    </lightning-input>
                </div>

                <!-- ABBREVIATION -->
                <div class="slds-col slds-size_2-of-12">
                    <lightning-input
                        label="Policy Abbreviation"
                        value={policy.abbr}
                        data-index={index}
                        onchange={handleAbbrChange}
                        disabled={policy.isDisabled}>
                    </lightning-input>
                </div>

                <!-- COST -->
                <div class="slds-col slds-size_2-of-12">
                    <lightning-input
                        type="number"
                        label="Cost / Sqft"
                        value={policy.cost}
                        data-index={index}
                        onchange={handleCostChange}
                        disabled={policy.isDisabled}>
                    </lightning-input>
                </div>

                <!-- CONSTRUCTION LINKED -->
                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                    <lightning-input
                        type="checkbox"
                        label="Construction Linked"
                        checked={policy.isConstructionLinked}
                        data-index={index}
                        onchange={handleConstructionLinkedChange}
                        disabled={policy.isDisabled}>
                    </lightning-input>
                </div>

                <!-- ACTIONS -->
                <div class="slds-col slds-size_2-of-12 slds-m-top_large slds-text-align_center">
                    <lightning-button-icon
                        icon-name="utility:edit"
                      
                        data-index={index}
                        onclick={handleEditPolicy}>
                    </lightning-button-icon>

                    <lightning-button-icon
                        icon-name="utility:delete"
                        
                        data-index={index}
                        onclick={handleDeletePolicy}>
                    </lightning-button-icon>
                </div>

            </div>

            <!-- TERMS SECTION -->
            <div class="slds-m-top_medium slds-p-left_medium">
                 <lightning-button
                    class="slds-m-top_small"
                    label="Add Term"
                    data-index={index}

                    onclick={handleAddTerm}>
                </lightning-button>

                <template for:each={policy.terms} for:item="term" for:index="tIndex">

                    <div key={term.id} class="slds-grid slds-wrap slds-gutters slds-m-bottom_x-small">

                        <!-- TERM S.NO -->
                        <div class="slds-col slds-size_1-of-12 slds-text-align_center">
                            <label class="slds-form-element__label">S.No</label>
                            <div class="slds-form-element__control">{term.serial}</div>
                        </div>

                        <!-- TERM NAME -->
                        <div class="slds-col slds-size_3-of-12">
                            <lightning-input
                                label="Term Name"
                                value={term.termName}
                                data-pindex={index}
                                data-tindex={tIndex}
                                onchange={handleTermNameChange}
                                disabled={term.isDisabled}>
                            </lightning-input>
                        </div>

                        <!-- PERCENTAGE -->
                        <div class="slds-col slds-size_2-of-12">
                            <lightning-input
                                type="number"
                                label="Percentage"
                                value={term.percent}
                                data-pindex={index}
                                data-tindex={tIndex}
                                onchange={handleTermPercentChange}
                                disabled={term.isDisabled}>
                            </lightning-input>
                        </div>

                        <!-- PAYMENT WITHIN -->
                        <div class="slds-col slds-size_3-of-12">
                            <lightning-input
                                type="number"
                                label="Payment Within"
                                value={term.paymentWithin}
                                data-pindex={index}
                                data-tindex={tIndex}
                                onchange={handleTermPaymentChange}
                                disabled={term.isDisabled}>
                            </lightning-input>
                        </div>

                        <!-- TERM ACTIONS -->
                        <div class="slds-col slds-size_3-of-12 slds-m-top_large slds-text-align_center">
                            <lightning-button-icon
                                icon-name="utility:edit"
                                data-pindex={index}
                                data-tindex={tIndex}
                                onclick={handleEditTerm}>
                            </lightning-button-icon>

                            <lightning-button-icon
                                icon-name="utility:delete"
                                data-pindex={index}
                                data-tindex={tIndex}
                                onclick={handleDeleteTerm}>
                            </lightning-button-icon>
                        </div>

                    </div>

                </template>

                <!-- ADD TERM BUTTON -->
               

            </div>

        </div>

    </template>

</template>