
<template>
    <div class="vortex-wrapper">

        <!-- HEADER -->
        <div class="vortex-header">
            <h1>Post Construction Update</h1>
            <p>Upload construction progress details</p>
        </div>

        <!-- MAIN GRID -->
        <div class="slds-grid slds-wrap slds-gutters vortex-grid">

            <!-- ROW 1 -->
            <!-- 1️⃣ Select Towers (Required | Multi) -->
            <div class="slds-col slds-size_1-of-2">
                <div class="vortex-section vortex-card tower-wrapper">

                    <label class="vortex-label">
                        Select Towers <span class="slds-required">*</span>
                    </label>

                    <!-- FIELD ROW (MATCHES PICKLIST HEIGHT) -->
                    <div class="vortex-field vortex-field-fixed">
                        <lightning-input data-input="tower" variant="label-hidden" placeholder="Search Towers"
                            onclick={handleTowerClick} onkeyup={handleTowers} class="vortex-input">
                        </lightning-input>

                        <template if:true={showDropdown}>
                            <div class="vortex-dropdown">
                                <template for:each={searchTowers} for:item="tower">
                                    <div key={tower.Id} class="vortex-option" data-id={tower.Id} data-name={tower.Name}
                                        onclick={handleSelect}>
                                        {tower.Name}
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>

                    <!-- Pills BELOW input (does not affect spacing) -->
                    <template if:true={selectedTowers.length}>
                        <lightning-pill-container items={selectedTowers} onitemremove={handleRemove}
                            class="vortex-pills">
                        </lightning-pill-container>
                    </template>

                    <template if:true={towerError}>
                        <p class="vortex-error">{towerError}</p>
                    </template>
                </div>
            </div>

            <!-- 2️⃣ Select Milestone (Required | Single) -->
            <div class="slds-col slds-size_1-of-2">
                <div class="vortex-section vortex-card">

                    <label class="vortex-label">
                        Select Milestone <span class="slds-required">*</span>
                    </label>

                    <div class="vortex-field vortex-field-fixed">
                        <lightning-combobox value={selectedMilestone} options={milestoneOptions}
                            placeholder="Select Milestone" onchange={handleMilestoneChange} class="vortex-combobox">
                        </lightning-combobox>
                    </div>

                    <template if:true={milestoneError}>
                        <p class="vortex-error">{milestoneError}</p>
                    </template>
                </div>
            </div>

            <!-- ROW 2 -->
            <!-- 3️⃣ Construction Stage (Optional) -->
            <div class="slds-col slds-size_1-of-2">
                <div class="vortex-section vortex-card">

                    <label class="vortex-label">
                        Construction Stage
                    </label>

                    <div class="vortex-field vortex-field-fixed">
                        <lightning-combobox value={constructionStage} options={constructionStageOptions}
                            placeholder="Select Construction Stage" onchange={handleStageChange}
                            class="vortex-combobox">
                        </lightning-combobox>
                    </div>
                </div>
            </div>

            <!-- 4️⃣ Upload Images -->
            <!-- 4️⃣ Upload Images -->
            <div class="slds-col slds-size_1-of-2">
                <div class="vortex-section vortex-card">

                    <label class="vortex-label">
                        Upload Construction Images
                    </label>

                    <div class="vortex-field vortex-upload">
                        <lightning-file-upload record-id={recordId} accept={acceptedFormats} multiple
                            onuploadfinished={handleUploadFinished}>
                        </lightning-file-upload>
                    </div>

                    <!-- Uploaded file names -->
                    <template if:true={uploadedFiles.length}>
                        <ul class="vortex-file-list">
                            <template for:each={uploadedFiles} for:item="file">
                                <li key={file.id} class="vortex-file-item">
                                    {file.name}
                                </li>
                            </template>
                        </ul>
                    </template>

                    <template if:true={uploadError}>
                        <p class="vortex-error">{uploadError}</p>
                    </template>
                </div>
            </div>


        </div>

        <!-- FOOTER -->
        <div class="vortex-footer">
            <lightning-button variant="neutral" label="Cancel" onclick={handleCancel}>
            </lightning-button>

            <lightning-button variant="brand" label="Save" class="slds-m-left_small" onclick={handleSave}>
            </lightning-button>
        </div>

    </div>
</template>