<template>
    <lightning-card title="Create Scoring Criteria">
        <div class="container">
            <div class="left-box">
                <lightning-combobox label="Object" value={selectedObject} options={objectOptions}
                    onchange={handleObjectChange} placeholder="Select an Object"></lightning-combobox>
            </div>
        </div>

        <template if:true={showCriteriaSection}>
            <div class="scroll-area">
                <template for:each={criteriaList} for:item="crit" for:index="critIndex">
                    <div key={crit.id} class="criteria-section">

                        <div class="criteria-header">
                            <div>S.No</div>
                            <div>Criteria Name</div>
                            <div>Score</div>
                            <div>Condition Criteria</div>
                            <div>Condition Logic</div>
                        </div>

                        <div class="criteria-row">
                            <div>{crit.serial}</div>

                            <lightning-input placeholder="Enter Criteria Name" name="criteriaName"
                                value={crit.criteriaName} data-index={critIndex}
                                onchange={handleCriteriaInput}></lightning-input>
                            <lightning-input type="number" placeholder="Score" name="score" value={crit.score}
                                data-index={critIndex} onchange={handleCriteriaInput}></lightning-input>
                            <lightning-combobox value={crit.conditionCriteria} options={conditionCriteriaOptions}
                                data-index={critIndex} onchange={handleConditionCriteriaChange}>
                            </lightning-combobox>

                            <template if:true={crit.showConditionLogic}>
                                <lightning-input placeholder="Enter Condition Logic" name="conditionLogic"
                                    value={crit.conditionLogic} data-index={critIndex}
                                    onchange={handleCriteriaInput}></lightning-input>
                            </template>

                            <template if:false={crit.isFirst}>
                                <lightning-button-icon icon-name="utility:delete" variant="bare"
                                    alternative-text="Delete Criteria" data-index={critIndex}
                                    onclick={handleDeleteCriteria}>
                                </lightning-button-icon>
                            </template>
                        </div>

                        <div class="condition-box">
                            <div class="condition-header">
                                <div>S.No</div>
                                <div>Field</div>
                                <div>Operator</div>
                                <div>Value</div>
                                <div></div>
                            </div>

                            <template for:each={crit.conditions} for:item="cond" for:index="condIndex">
                                <div key={cond.id} class="condition-row">

                                    <div class="condition-serial">{cond.serial}</div>

                                    <lightning-combobox name="field" options={fieldOptions} value={cond.field}
                                        data-crit-index={critIndex} data-cond-index={condIndex}
                                        onchange={handleConditionInputChange}>
                                    </lightning-combobox>

                                    <lightning-combobox name="operator" value={cond.operator}
                                        data-crit-index={critIndex} options={cond.operatorOptions}
                                        data-cond-index={condIndex} onchange={handleConditionInputChange}>
                                    </lightning-combobox>

                                    <!-- PICKLIST VALUE -->
                                    <template if:true={cond.isPicklist}>
                                        <lightning-combobox name="value" value={cond.value}
                                            options={cond.picklistOptions} data-crit-index={critIndex}
                                            data-cond-index={condIndex} onchange={handleConditionInputChange}>
                                        </lightning-combobox>
                                    </template>

                                    <!-- BETWEEN RANGE -->
                                    <template if:true={cond.showRange}>
                                        <div class="range-inputs">
                                            <lightning-input label="From" type={cond.valueInputType} name="fromValue"
                                                value={cond.fromValue} data-crit-index={critIndex}
                                                data-cond-index={condIndex} onchange={handleConditionInputChange}>
                                            </lightning-input>

                                            <lightning-input label="To" type={cond.valueInputType} name="toValue"
                                                value={cond.toValue} data-crit-index={critIndex}
                                                data-cond-index={condIndex} onchange={handleConditionInputChange}>
                                            </lightning-input>
                                        </div>
                                    </template>

                                    <!-- DEFAULT INPUT -->
                                    <template if:false={cond.isPicklist}>
                                        <template if:false={cond.showRange}>
                                            <lightning-input name="value" value={cond.value} type={cond.valueInputType}
                                                data-crit-index={critIndex} data-cond-index={condIndex}
                                                onchange={handleConditionInputChange}>
                                            </lightning-input>
                                        </template>
                                    </template>


                                    <template if:true={condIndex}>
                                        <lightning-button-icon icon-name="utility:delete" alternative-text="Delete"
                                            variant="bare" data-crit-index={critIndex} data-cond-index={condIndex}
                                            onclick={handleDeleteCondition}>
                                        </lightning-button-icon>
                                    </template>

                                </div>
                            </template>

                            <div class="action-row">
                                <div class="condition-actions">
                                    <lightning-button label="Add Condition" variant="brand" data-index={critIndex}
                                        onclick={handleAddCondition}></lightning-button>
                                </div>
                            </div>

                        </div>

                    </div>
                </template>

                <div class="action-row">
                    <div class="criteria-actions">
                        <template if:true={showAddCriteriaButton}>
                            <lightning-button label="Add Criteria" variant="brand" onclick={handleAddCriteria}>
                            </lightning-button>
                        </template>
                    </div>
                   

                </div>
            </div>
        </template>
        <template if:true={showFooterButtons}>
            <div class="sticky-footer">
                <lightning-button label="Cancel" variant="brand" onclick={handleCancel}>
                </lightning-button>
                <lightning-button label="Submit" variant="brand" onclick={handleSubmit}>
                </lightning-button>
            </div>
        </template>

    </lightning-card>
</template>