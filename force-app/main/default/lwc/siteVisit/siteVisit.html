<template>
    <lightning-card title="Site Visit Form" icon-name="standard:visit_templates">

        <div class="slds-p-around_medium">

            <div class="slds-text-title_caps slds-m-bottom_small">
                Site Visit Details
            </div>

            <div class="slds-scrollable_x">
                <template for:each={rows} for:item="row" for:index="index">
                    <div key={row.id} class="slds-grid slds-gutters slds-m-bottom_small" style="min-width:2000px">


                        <div class="slds-col" style="min-width:220px">
                            <lightning-input label="Customer" value={row.customerName} disabled>
                            </lightning-input>
                        </div>


                        <div class="slds-col" style="min-width:180px">
                            <lightning-input type="date" label="Visit Date" value={row.visitDate} min={today}
                                data-index={index} data-field="visitDate" onchange={handleRowChange}>
                            </lightning-input>
                        </div>

                        <!-- Visit Time -->
                        <div class="slds-col" style="min-width:160px">
                            <lightning-input type="time" label="Visit Time" value={row.visitTime} data-index={index}
                                data-field="visitTime" onchange={handleRowChange}>
                            </lightning-input>
                        </div>


                        <div class="slds-col" style="min-width:260px">
                            <lightning-input type="email" label="Email" value={row.customerEmail} data-index={index}
                                data-field="customerEmail" onchange={handleRowChange}> =
                            </lightning-input>
                        </div>


                        <div class="slds-col" style="min-width:180px">
                            <lightning-input type="tel" label="Phone" value={row.customerPhone} data-index={index}
                                data-field="customerPhone" onchange={handleRowChange}>
                            </lightning-input>
                        </div>



                        <!-- Project -->
                        <div class="slds-col" style="min-width:220px">
                            <lightning-combobox label="Project" value={row.projectId} options={projectOptions}
                                data-index={index} data-field="projectId" onchange={handleProjectChange}>
                            </lightning-combobox>
                        </div>

                     <!-- Visit Type -->
                        <div class="slds-col" style="min-width:180px">
                            <lightning-combobox label="Visit Type" value={row.visitType} options={row.visitTypeOptions}
                                data-index={index} data-field="visitType" onchange={handleRowChange}>
                            </lightning-combobox>
                        </div>

                        <!-- Tower -->
                        <div class="slds-col" style="min-width:220px">
                            <lightning-combobox label="Tower" value={row.towerId} options={row.towerOptions}
                                data-index={index} data-field="towerId" onchange={handleRowChange}
                                disabled={row.isTowerDisabled}>
                            </lightning-combobox>
                        </div>

                        <!-- Sales Rep -->
                        <div class="slds-col" style="min-width:260px">
                            <lightning-record-picker label="Sales Representative" object-api-name="User"
                                value={row.salesRepId} data-index={index} onchange={handleSalesRepChange}>
                            </lightning-record-picker>
                        </div>

                        <!-- Delete -->
                        <div class="slds-col slds-align_absolute-center" style="min-width:80px">
                            <lightning-button-icon icon-name="utility:delete" onclick={removeRow} data-index={index}
                                disabled={row.isFirst}>
                            </lightning-button-icon>
                        </div>

                    </div>
                </template>
            </div>

            <div class="slds-m-top_medium">
                <lightning-button label="Add Row" icon-name="utility:add" onclick={addRow}>
                </lightning-button>
            </div>

        </div>

        <div slot="footer" class="slds-grid slds-grid_align-end">
            <lightning-button label="Cancel" onclick={handleCancel}>
            </lightning-button>

            
            <lightning-button label="Submit" variant="brand" class="slds-m-left_small" onclick={handleSubmit}>
            </lightning-button>
        </div>


    </lightning-card>
</template>